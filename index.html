<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Monitoramento de Port√µes</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 0; }
    .mapa { position: relative; background-color: #dcdcdc; height: 90vh; margin: 10px; }
    .portao, .armazem {
      position: absolute; padding: 5px 10px; background-color: gray; color: white;
      border-radius: 4px; cursor: pointer; font-size: 14px;
    }
    .armazem { background-color: #444; cursor: default; }
    .formulario {
      position: fixed; bottom: 20px; right: 20px; background: white;
      padding: 15px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.2); display: none;
    }
    .formulario label { display: block; margin-top: 10px; }
    .formulario input, .formulario select { width: 100%; padding: 5px; margin-top: 4px; }
    .formulario button { margin-top: 10px; padding: 8px; cursor: pointer; }
    .btn-exportar { margin: 10px; padding: 8px 12px; background: #007BFF; color: white; border: none; border-radius: 4px; }
  </style>
</head>
<body>

  <button class="btn-exportar" onclick="baixarCSV()">üì• Exportar CSV</button>

  <div class="mapa">
    <!-- Port√µes -->
    <div class="portao" id="portao-RIG1-0260-ARMF-PA03" style="top: 15%; left: 14%;" onclick="abrirFormulario('RIG1-0260-ARMF-PA03')">P03</div>
    <div class="portao" id="portao-RIG1-0260-ARMF-PA04" style="top: 10%; left: 20%;" onclick="abrirFormulario('RIG1-0260-ARMF-PA04')">P04</div>
    <div class="portao" id="portao-RIG1-0260-ARMF-PA02" style="top: 50%; left: 14%;" onclick="abrirFormulario('RIG1-0260-ARMF-PA02')">P02</div>
    <div class="portao" id="portao-RIG1-0260-ARMF-PA01" style="top: 50%; left: 22%;" onclick="abrirFormulario('RIG1-0260-ARMF-PA01')">P01</div>
    <div class="portao" id="portao-RIG1-0260-ARME-PA01" style="top: 50%; left: 30%;" onclick="abrirFormulario('RIG1-0260-ARME-PA01')">P01</div>
    <div class="portao" id="portao-RIG1-0260-ARMD-PA01" style="top: 50%; left: 38%;" onclick="abrirFormulario('RIG1-0260-ARMD-PA01')">P01</div>
    <div class="portao" id="portao-RIG1-0260-ARMD-PA02" style="top: 12%; left: 36%;" onclick="abrirFormulario('RIG1-0260-ARMD-PA02')">P02</div>
    <div class="portao" id="portao-RIG1-0260-ARME-PA02" style="top: 16%; left: 27%;" onclick="abrirFormulario('RIG1-0260-ARME-PA02')">P02</div>
    <div class="portao" id="portao-RIG1-0260-ARMB-PA03" style="top: 30%; left: 60%;" onclick="abrirFormulario('RIG1-0260-ARMB-PA03')">P02</div>
    <div class="portao" id="portao-RIG1-0260-ARMC-PA03" style="top: 30%; left: 53%;" onclick="abrirFormulario('RIG1-0260-ARMC-PA03')">P02</div>
    <div class="portao" id="portao-RIG1-0260-ARMB-PA04" style="top: 60%; left: 60%;" onclick="abrirFormulario('RIG1-0260-ARMB-PA04')">P01</div>
    <div class="portao" id="portao-RIG1-0260-ARMC-PA04" style="top: 60%; left: 53%;" onclick="abrirFormulario('RIG1-0260-ARMC-PA04')">P01</div>
    <div class="portao" id="portao-RIG1-0260-ARMA-PA06" style="top: 60%; left: 69%;" onclick="abrirFormulario('RIG1-0260-ARMA-PA06')">P06</div>
    <div class="portao" id="portao-RIG1-0260-ARMA-PA05" style="top: 40%; left: 75%;" onclick="abrirFormulario('RIG1-0260-ARMA-PA05')">P05</div>
    <div class="portao" id="portao-RIG1-0260-ARMA-PA04" style="top: 20%; left: 75%;" onclick="abrirFormulario('RIG1-0260-ARMA-PA04')">P04</div>
    <div class="portao" id="portao-RIG1-0260-ARMA-PA02" style="top: 20%; left: 70%;" onclick="abrirFormulario('RIG1-0260-ARMA-PA02')">P02</div>
    <div class="portao" id="portao-RIG1-0260-ARMA-PA03" style="top: 37%; left: 64%;" onclick="abrirFormulario('RIG1-0260-ARMA-PA03')">P03</div>
    <div class="portao" id="portao-RIG1-CR120" style="top: 55%; left: 75%;" onclick="abrirFormulario('RIG1-CR120')">Port√£o CR120</div>
    <div class="portao" id="portao-RIG1-0260-ARMA-PA01 CR150" style="top: 65%; left: 65%;" onclick="abrirFormulario('RIG1-0260-ARMA-PA01 CR150')">P01</div>

    <!-- Armaz√©ns -->
    <div class="armazem" style="top: 25%; left: 12%;">Armaz√©m F</div>
    <div class="armazem" style="top: 25%; left: 25%;">Armaz√©m E</div>
    <div class="armazem" style="top: 25%; left: 38%;">Armaz√©m D</div>
    <div class="armazem" style="top: 55%; left: 60%; transform: rotate(-90deg); transform-origin: left top;">Armaz√©m B</div>
    <div class="armazem" style="top: 55%; left: 55%; transform: rotate(-90deg); transform-origin: left top;">Armaz√©m C</div>
    <div class="armazem" style="top: 60%; left: 70%; transform: rotate(-90deg); transform-origin: left top;">Armaz√©m A</div>
    <div class="armazem" style="top: 59%; left: 65%; transform: rotate(-90deg); transform-origin: left top;">Granula√ß√£o CR150</div>
    <div class="armazem" style="top: 40%; left: 75%; transform: rotate(-90deg); transform-origin: left top;">Armaz√©m Cura</div>
  </div>

  <div class="formulario" id="formulario">
    <h3>Status do Port√£o</h3>
    <label for="status">Status:</label>
    <select id="status">
      <option value="aberto">Aberto</option>
      <option value="fechado">Fechado</option>
      <option value="manutencao">Em Manuten√ß√£o</option>
    </select>
    <label for="ordemSap">Ordem SAP:</label>
    <input type="text" id="ordemSap" placeholder="Ex: 4500000000" />
    <label for="observacoes">Observa√ß√µes:</label>
    <input type="text" id="observacoes" placeholder="Equipe, data, hora..." />
    <button onclick="salvarStatus()">Salvar</button>
    <button onclick="fecharFormulario()">Cancelar</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
    apiKey: "AIzaSyBNLGsUrMFLSA9NmqkKPlouWeO7ttvM6Fc",
    authDomain: "armazensrig.firebaseapp.com",
    databaseURL: "https://armazensrig-default-rtdb.firebaseio.com",
    projectId: "armazensrig",
    storageBucket: "armazensrig.firebasestorage.app",
    messagingSenderId: "561768076694",
    appId: "1:561768076694:web:3f9cba366f19eed543f9b7"
  };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const statusInput = document.getElementById("status");
    const ordemSapInput = document.getElementById("ordemSap");
    const observacoesInput = document.getElementById("observacoes");
    const formulario = document.getElementById("formulario");

    let portaoAtual = "";

    window.abrirFormulario = function(id) {
      portaoAtual = id;
      const refPortao = ref(db, `portoes/${portaoAtual}`);
      get(refPortao).then((snapshot) => {
        if (snapshot.exists()) {
          const dados = snapshot.val();
          statusInput.value = dados.status || "fechado";
          ordemSapInput.value = dados.ordemSap || "";
          observacoesInput.value = dados.observacoes || "";
        }
        formulario.style.display = "block";
      });
    }

    window.fecharFormulario = function() {
      formulario.style.display = "none";
    }

    window.salvarStatus = function() {
      const status = statusInput.value;
      const ordemSap = ordemSapInput.value;
      const observacoes = observacoesInput.value;
      const data = new Date().toLocaleString();

      const refPortao = ref(db, `portoes/${portaoAtual}`);
      set(refPortao, {
        status, ordemSap, observacoes, data
      });

      const botao = document.getElementById(`portao-${portaoAtual}`);
      if (botao) {
        botao.style.backgroundColor =
          status === "aberto" ? "green" :
          status === "fechado" ? "red" :
          status === "manutencao" ? "orange" : "gray";
      }

      fecharFormulario();
    }

    window.baixarCSV = function() {
      const refPortoes = ref(db, "portoes");
      get(refPortoes).then(snapshot => {
        if (!snapshot.exists()) return alert("Nenhum dado encontrado.");

        let csv = "Portao,Status,Ordem SAP,Data,Observa√ß√µes\n";
        const portoes = snapshot.val();
        for (const id in portoes) {
          const { status, ordemSap, data, observacoes } = portoes[id];
          csv += `${id},${status || ''},${ordemSap || ''},"${data || ''}","${observacoes || ''}"\n`;
        }

        const blob = new Blob([csv], { type: "text/csv" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "portoes.csv";
        link.click();
      });
    }

    function atualizarCores() {
      const refPortoes = ref(db, "portoes");
      onValue(refPortoes, (snapshot) => {
        const dados = snapshot.val();
        for (const id in dados) {
          const botao = document.getElementById(`portao-${id}`);
          if (botao) {
            const status = dados[id].status;
            botao.style.backgroundColor =
              status === "aberto" ? "green" :
              status === "fechado" ? "red" :
              status === "manutencao" ? "orange" : "gray";
          }
        }
      });
    }

    atualizarCores();
  </script>
</body>
</html>

